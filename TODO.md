[ ] smoke tests on check (or refactor "main")
